<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Poll</title>
    <link href="https://fonts.googleapis.com/css2?family=Karla:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Karla', sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background-color 0.5s ease;
        }

        .poll-container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        .question-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            opacity: 0;
            transform: scale(0.9);
            transition: opacity 0.5s ease, transform 0.5s ease;
            text-align: center;
        }

        .question-slide.active {
            opacity: 1;
            transform: scale(1);
            z-index: 1;
        }

        .question-slide.exiting {
            opacity: 0;
            transform: scale(1.1);
        }

        .question-text {
            font-size: 24px;
            margin-bottom: 30px;
            font-weight: 700;
            max-width: 80%;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 15px;
            border-radius: 8px;
        }

        .answer-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 80%;
            max-width: 500px;
        }

        .answer-option {
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-family: 'Karla', sans-serif;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            background-color: rgba(255, 255, 255, 0.8);
        }

        .answer-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .progress-dots {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 30px;
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
        }

        .progress-dot.active {
            background-color: rgba(255, 255, 255, 0.9);
        }

        .navigation {
            position: absolute;
            top: 50%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
            z-index: 2;
        }

        .nav-button {
            background-color: rgba(255, 255, 255, 0.7);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .thank-you {
            display: none;
            text-align: center;
            padding: 20px;
        }

        /* Background color classes */
        .bg-tangy-orange { background-color: #DC6D18; color: #FFF4E4; }
        .bg-ivory-pearl { background-color: #FFF4E4; color: #2B1A12; }
        .bg-cream-pop { background-color: #F8E0C9; color: #2B1A12; }
        .bg-almost-black { background-color: #2B1A12; color: #FFF4E4; }
        .bg-limestone { background-color: #B1AA81; color: #2B1A12; }
    </style>
</head>
<body>
    <div class="poll-container">
        <div class="navigation">
            <button class="nav-button prev-button" disabled>&#9664;</button>
            <button class="nav-button next-button">&#9654;</button>
        </div>

        <!-- Question slides will be inserted here by JavaScript -->
        
        <div class="progress-dots"></div>
    </div>

    <div class="thank-you">
        <h2>Thank you for completing the poll!</h2>
        <p>Your responses have been recorded.</p>
    </div>

    <script>
        // Poll questions data (editable XML-like structure)
        const pollData = `
            <poll>
                <question bg="bg-tangy-orange">
                    <text>How satisfied are you with our product?</text>
                    <answers>
                        <answer>Very satisfied</answer>
                        <answer>Somewhat satisfied</answer>
                        <answer>Neutral</answer>
                        <answer>Somewhat dissatisfied</answer>
                        <answer>Very dissatisfied</answer>
                    </answers>
                </question>
                <question bg="bg-ivory-pearl">
                    <text>How often do you use our service?</text>
                    <answers>
                        <answer>Daily</answer>
                        <answer>Weekly</answer>
                        <answer>Monthly</answer>
                        <answer>Rarely</answer>
                        <answer>First time</answer>
                    </answers>
                </question>
                <question bg="bg-cream-pop">
                    <text>What feature do you value the most?</text>
                    <answers>
                        <answer>Ease of use</answer>
                        <answer>Speed</answer>
                        <answer>Design</answer>
                        <answer>Functionality</answer>
                        <answer>Customer support</answer>
                    </answers>
                </question>
                <question bg="bg-almost-black">
                    <text>Would you recommend us to others?</text>
                    <answers>
                        <answer>Definitely yes</answer>
                        <answer>Probably yes</answer>
                        <answer>Not sure</answer>
                        <answer>Probably not</answer>
                        <answer>Definitely not</answer>
                    </answers>
                </question>
                <question bg="bg-limestone">
                    <text>Any additional comments or feedback?</text>
                    <answers>
                        <answer>No comments</answer>
                        <answer><input type="text" placeholder="Type your feedback..." class="feedback-input"></answer>
                    </answers>
                </question>
            </poll>
        `;

        // Parse the XML-like data
        function parsePollData(xmlString) {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlString, "text/xml");
            const questions = xmlDoc.getElementsByTagName("question");
            const result = [];
            
            for (let i = 0; i < questions.length; i++) {
                const question = questions[i];
                const text = question.getElementsByTagName("text")[0].textContent;
                const answers = [];
                const answerElements = question.getElementsByTagName("answer");
                const bg = question.getAttribute("bg") || "bg-ivory-pearl";
                
                for (let j = 0; j < answerElements.length; j++) {
                    answers.push(answerElements[j].textContent || answerElements[j].innerHTML);
                }
                
                result.push({
                    text,
                    answers,
                    bg
                });
            }
            
            return result;
        }

        // Initialize the poll
        const questions = parsePollData(pollData);
        const pollContainer = document.querySelector('.poll-container');
        const progressDots = document.querySelector('.progress-dots');
        const prevButton = document.querySelector('.prev-button');
        const nextButton = document.querySelector('.next-button');
        const thankYou = document.querySelector('.thank-you');
        
        let currentQuestion = 0;
        const responses = {};
        let touchStartX = 0;
        let touchEndX = 0;

        // Create question slides
        questions.forEach((question, index) => {
            const slide = document.createElement('div');
            slide.className = `question-slide ${question.bg}`;
            if (index === 0) slide.classList.add('active');
            
            const questionText = document.createElement('div');
            questionText.className = 'question-text';
            questionText.textContent = question.text;
            slide.appendChild(questionText);
            
            const answerOptions = document.createElement('div');
            answerOptions.className = 'answer-options';
            
            question.answers.forEach((answer, answerIndex) => {
                const button = document.createElement('button');
                button.className = 'answer-option';
                
                // Check if the answer contains an input field
                if (answer.includes('<input')) {
                    button.innerHTML = answer;
                    button.style.padding = '5px';
                    const input = button.querySelector('input');
                    input.addEventListener('input', () => {
                        responses[question.text] = input.value;
                    });
                } else {
                    button.textContent = answer;
                    button.addEventListener('click', () => {
                        responses[question.text] = answer;
                        nextQuestion();
                    });
                }
                
                answerOptions.appendChild(button);
            });
            
            slide.appendChild(answerOptions);
            pollContainer.insertBefore(slide, progressDots);
            
            // Create progress dot
            const dot = document.createElement('div');
            dot.className = 'progress-dot';
            if (index === 0) dot.classList.add('active');
            dot.addEventListener('click', () => goToQuestion(index));
            progressDots.appendChild(dot);
        });

        // Navigation functions
        function goToQuestion(index) {
            if (index < 0 || index >= questions.length) return;
            
            const currentSlide = document.querySelector('.question-slide.active');
            const nextSlide = document.querySelectorAll('.question-slide')[index];
            const dots = document.querySelectorAll('.progress-dot');
            
            currentSlide.classList.remove('active');
            currentSlide.classList.add('exiting');
            
            setTimeout(() => {
                currentSlide.classList.remove('exiting');
                nextSlide.classList.add('active');
                
                // Update dots
                dots.forEach((dot, i) => {
                    if (i === index) {
                        dot.classList.add('active');
                    } else {
                        dot.classList.remove('active');
                    }
                });
                
                // Update navigation buttons
                prevButton.disabled = index === 0;
                nextButton.disabled = index === questions.length - 1;
                
                // Update background color
                document.body.className = questions[index].bg;
                
                currentQuestion = index;
            }, 500);
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                goToQuestion(currentQuestion + 1);
            } else {
                // Submit the poll
                submitPoll();
            }
        }

        function prevQuestion() {
            if (currentQuestion > 0) {
                goToQuestion(currentQuestion - 1);
            }
        }

        // Event listeners for navigation
        nextButton.addEventListener('click', nextQuestion);
        prevButton.addEventListener('click', prevQuestion);

        // Touch events for swiping
        pollContainer.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
        }, false);

        pollContainer.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        }, false);

        function handleSwipe() {
            if (touchEndX < touchStartX - 50) {
                // Swipe left - next question
                nextQuestion();
            } else if (touchEndX > touchStartX + 50) {
                // Swipe right - previous question
                prevQuestion();
            }
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') {
                nextQuestion();
            } else if (e.key === 'ArrowLeft') {
                prevQuestion();
            }
        });

        // Submit poll to Google Sheets
        function submitPoll() {
            // Hide the poll and show thank you message
            pollContainer.style.display = 'none';
            thankYou.style.display = 'block';
            
            // Prepare data for Google Sheets
            const formData = new FormData();
            formData.append('timestamp', new Date().toISOString());
            
            Object.entries(responses).forEach(([question, answer]) => {
                formData.append(question, answer);
            });
            
            // Replace with your Google Apps Script Web App URL
            const scriptUrl = 'https://script.google.com/macros/s/AKfycbzYgzkwP3iGiPOORcjHHfJwiuCjSIzLZvOUGuApqWliTFxhBUTuyMMS_BxPWwwuPWYvSA/exec';
            
            fetch(scriptUrl, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log('Success:', data);
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        // Set initial background color
        document.body.className = questions[0].bg;
    </script>
</body>
</html>
